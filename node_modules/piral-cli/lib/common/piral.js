"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const VirtualPackager_1 = require("./VirtualPackager");
function modifyBundlerForPiral(proto, targetDir) {
    const name = path_1.join('lib', 'shared-dependencies.js');
    const ra = proto.getLoadedAsset;
    proto.getLoadedAsset = function (path) {
        if (path.endsWith(name)) {
            path = path_1.join(targetDir, 'shared-dependencies.vm');
        }
        return ra.call(this, path);
    };
}
exports.modifyBundlerForPiral = modifyBundlerForPiral;
function extendBundlerForPiral(bundler) {
    bundler.parser.registerExtension('vm', require.resolve('./SharedDependenciesAsset'));
    bundler.packagers.add('vm', VirtualPackager_1.VirtualPackager);
}
exports.extendBundlerForPiral = extendBundlerForPiral;
//# sourceMappingURL=piral.js.map